{
    "scheduleOption": 0,
    "dataType": 0,
    "description": "",
    "appliesTo": "system.virtualization == \"VMWare ESX host\"",
    "technology": "",
    "type": "propertyrule",
    "params": [
        {
            "name": "linuxcmdline",
            "comment": "",
            "value": ""
        },
        {
            "name": "linuxscript",
            "comment": "",
            "value": ""
        },
        {
            "name": "scriptgroovy",
            "comment": "",
            "value": "import com.santaba.agent.groovyapi.esx.ESX\r\nimport com.vmware.vim25.mo.InventoryNavigator\r\nimport com.vmware.vim25.mo.ClusterComputeResource\r\n\r\n\r\ndef hostname = hostProps.get(\"system.hostname\");\r\ndef user = hostProps.get(\"esx.user\");\r\ndef pass = hostProps.get(\"esx.pass\");\r\ndef custom_url = hostProps.get(\"esx.url\");\r\n\r\n// connect up to the esx service\r\ndef url = custom_url ?: String.format(\"https://%s/sdk\", hostname);\r\ndef svc = new ESX();\r\nsvc.open(url, user, pass, 10 * 1000); // timeout in 10 seconds\r\n\r\n// Get resource clusters\r\ndef si = svc.getServiceInstance();\r\ndef rootFolder = si.getRootFolder();\r\nhosts = new InventoryNavigator(rootFolder).searchManagedEntities(\"HostSystem\");\r\n\r\nhosts.each\r\n{ host ->\r\n\r\n    // To cut down on API calls\r\n    def hardware = host.hardware\r\n    def summary = host.summary\r\n    def network = host.config?.network\r\n\r\n    // get memory\r\n    def memory_mb = Math.round(hardware.memorySize / 1024 / 1024);\r\n    println \"esxi_.memory_mb=\" + memory_mb;\r\n    \r\n    //get hardware make/model\r\n    println \"esxi_manufacturer=\" + hardware?.systemInfo?.vendor;\r\n    println \"esxi_model=\" + hardware?.systemInfo?.model;\r\n    \r\n    //host cpu info\r\n    println \"esxi_cpu_cores=\" + hardware?.cpuInfo?.numCpuCores;\r\n    println \"esxi_cpu_details=\" + summary?.hardware?.cpuModel;\r\n\r\n    //host bios information\r\n    println \"esxi_bios_ver=\" + hardware?.biosInfo?.biosVersion;\r\n\r\n    //get the ip of the vcenter server that controls this host, will be null for standalone hosts\r\n    println \"esxi_managed_by_vcenter=\" + summary?.managementServerIp;\r\n    \r\n    //get hostname\r\n    println \"esxi_hostname=\" + summary?.config?.name;\r\n    \r\n    //get esxi console ip info\r\n    println \"esxi_vnic0_mac=\" + network?.vnic[0]?.spec?.mac;\r\n    println \"esxi_vnic0_ip=\" + network?.vnic[0]?.spec?.ip?.ipAddress;\r\n    println \"esxi_vnic0_subnet=\" + network?.vnic[0]?.spec?.ip?.subnetMask;\r\n    \r\n    //get serial number\r\n    def otherInfo = hardware?.systemInfo?.otherIdentifyingInfo;\r\n    def stIndex = otherInfo?.identifierType?.key?.indexOf('ServiceTag');\r\n    def serviceTag = otherInfo?.identifierValue[stIndex];\r\n    println \"esxi_serial=\" + serviceTag;\r\n\r\n    //VMWare reference doc: https://bit.ly/2SeBbnf\r\n\r\n}\r\nreturn (0);"
        },
        {
            "name": "scripttype",
            "comment": "embed",
            "value": "embed"
        },
        {
            "name": "windowscmdline",
            "comment": "",
            "value": ""
        },
        {
            "name": "windowsscript",
            "comment": "",
            "value": ""
        }
    ],
    "version": 1588005439,
    "tags": "",
    "auditVersion": 0,
    "name": "VMware_Host_BasicInfo",
    "id": 115,
    "group": "RFA Custom"
}